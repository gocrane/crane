<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.102.3"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>How to optimize your application in FinOps era | Crane</title><meta name=description content="How to optimize your application in FinOps era.
"><meta property="og:title" content="How to optimize your application in FinOps era"><meta property="og:description" content="How to optimize your application in FinOps era.
"><meta property="og:type" content="article"><meta property="og:url" content="/docs/best-practices/how-to-optimize-your-application-resource/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-03-15T04:27:07-05:00"><meta property="og:site_name" content="Crane"><meta itemprop=name content="How to optimize your application in FinOps era"><meta itemprop=description content="How to optimize your application in FinOps era.
"><meta itemprop=dateModified content="2024-03-15T04:27:07-05:00"><meta itemprop=wordCount content="2966"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="How to optimize your application in FinOps era"><meta name=twitter:description content="How to optimize your application in FinOps era.
"><link rel=preload href=/scss/main.min.730362c672539a20af5e07f8cb554bed1d08f06cf874786f2cba9f08a6a884cb.css as=style><link href=/scss/main.min.730362c672539a20af5e07f8cb554bed1d08f06cf874786f2cba9f08a6a884cb.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="图层_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="306" height="186" viewBox="144.139 425.446 306 186" enable-background="new 144.139 425.446 306 186"><path fill="#58bda6" d="M267.919 572.702c-.372 5.728-4.972 10.091-10.27 9.743l-40.779-2.65c-5.3-.347-9.293-5.269-8.923-10.991l2.974-45.702c.373-5.728 4.973-10.088 10.271-9.743l40.78 2.652c5.299.345 9.293 5.267 8.921 10.99L267.919 572.702z"/><path fill="#ee7300" d="M355.802 528.969c-28.058-24.713-63.021-62.657-91.196-87.232-1.938-1.69-5.604-3.409-7.457-2.647-1.938.795-3.404 4.46-3.778 7.058-1.761 12.192-2.91 28.237-4.656 40.433-.437 3.041-1.971 6.067-3.571 8.762-2.041 3.435-.873 12.792 2.958 15.723 3.085 2.357 4.303 5.096 1.854 7.834-1.351 1.512-4.525 1.391-6.992 2.032 2.374 2.482 5.765 2.633 9.24-.084 3.808-2.979 2.631-7.084-4.054-14.46 4.628-3.659 5.886-7.839 2.424-13.33-1.104-1.75-.191-4.886.068-7.356 1.027-9.761 2.094-23.278 3.315-33.019.292-2.324 1.237-4.564 2.349-8.479 26.078 34.224 56.794 78.868 82.623 112.767.93-6.764-.387-17.9-.708-23.131-.193-3.154-5.785-8.536-7.861-11.352-3.039-4.109-6.746-7.742-9.644-11.94-.76-1.101-.824-2.206.128-3.594 1.252-1.816 2.925.178 3.865 1.018 9.287 8.277 25.465 24.596 31.02 35.665.248.495-1.506-11.808-.865-10.746"/><path d="M185.44 554.611v-4.04c0-2.692-.57-4.727-1.712-6.104-1.145-1.375-2.634-2.062-4.475-2.062-3.021-.056-5.026.505-6.021 1.686-.994 1.179-1.49 2.806-1.49 4.881l-.11 31.229c0 1.796.515 3.188 1.548 4.166 1.028.982 2.834 1.476 5.412 1.476 1.618.0 2.908-.295 3.866-.883.957-.593 1.692-1.334 2.21-2.231.515-.896.828-1.88.938-2.946.11-1.064.166-2.076.166-3.028v-5.726h19.442v7.744c0 2.693-.534 5.176-1.603 7.449-1.067 2.271-2.727 4.224-4.972 5.85-2.247 1.629-5.156 2.894-8.729 3.788-3.573.897-7.826 1.347-12.761 1.347-4.493.0-8.305-.447-11.435-1.347-3.132-.896-5.688-2.201-7.679-3.914-1.988-1.71-3.442-3.813-4.363-6.312-.922-2.497-1.382-5.349-1.382-8.545V551.16c0-6.899 2.117-11.979 6.354-15.233 4.232-3.254 10.808-4.883 19.72-4.883 4.124.0 7.823.353 11.104 1.054 3.275.702 6.058 1.782 8.341 3.239 2.282 1.461 4.033 3.354 5.248 5.684s1.821 5.092 1.821 8.29v5.304H185.44V554.611z"/><path fill="#fff" d="M231.8 574.649l-16.795-1.156 3.754-54.526 24.521 1.688c6.934.479 12.024 1.985 15.27 4.521 3.243 2.536 4.682 6.521 4.308 11.945-.2 2.909-.979 5.362-2.329 7.364-1.354 2.001-3.818 3.488-7.4 4.457l-.009.146c2.324.553 4.212 1.483 5.653 2.801 1.443 1.316 2.162 2.924 2.161 4.824.049 1.125.066 2.486.052 4.094-.013 1.604-.028 3.235-.047 4.892-.019 1.655-.018 3.236.007 4.749.023 1.514.135 2.712.329 3.603.389.854.887 1.521 1.49 2.002l-.051.729-18.317-1.261c-.219-.552-.392-1.086-.515-1.608-.125-.518-.199-1.046-.228-1.586.039-2.43.165-4.724.379-6.877.211-2.148.247-4.084.11-5.799-.139-1.712-.569-3.105-1.294-4.18-.726-1.074-2.071-1.726-4.036-1.958l-5.533-.381L231.8 574.649zM233.957 543.314l5.726.396c1.208.081 2.222-.041 3.045-.375.821-.334 1.479-.801 1.966-1.399s.842-1.305 1.058-2.118c.216-.812.354-1.631.409-2.455.108-1.6-.026-2.875-.409-3.827-.38-.949-1.034-1.679-1.958-2.18-.923-.501-2.132-.842-3.62-1.017-1.49-.177-3.255-.311-5.294-.401L233.957 543.314z"/><path d="M265.164 595.689l18.116-63.132h23.423l18.006 63.132h-19.663l-2.762-12.291h-15.246l-2.318 12.291H265.164zm29.828-51.684h-.222l-5.634 28.282h11.269L294.992 544.005z"/><path d="M352.709 556.745l-.223.168 1.77 35.188h-18.448v-63.132h19.995l15.024 35.269h.331l-1.88-35.269h18.45V592.1h-19.887l-15.132-35.355z"/><path d="M397.406 595.689v-63.132h44.521v12.625H416.85V556.8h24.305v12.627H416.85v13.636h26.403v12.627L397.406 595.689z"/><circle fill="#fff" cx="344.901" cy="536.967" r="3.136"/></svg></span><span class=font-weight-bold>Crane</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><i class='fas fa-book pr-2'></i><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><i class='fas fa-rss pr-2'></i><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><i class='fab fa-youtube pr-2'></i><span>Community</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/gocrane/crane target=_blank><i class='fab fa-github pr-2'></i><span>GitHub</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=http://dashboard.gocrane.io/ target=_blank><i class='fa-regular fa-flag'></i><span>Live Demo</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Crane Blog</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Releases</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=https://gocrane.io>main</a></div></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh-cn/docs/best-practices/how-to-optimize-your-application-resource/>Chinese</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh-cn/docs/best-practices/how-to-optimize-your-application-resource/>Chinese</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgetting-started-li><input type=checkbox id=m-docsgetting-started-check>
<label for=m-docsgetting-started-check><a href=/docs/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgetting-started><span>Getting Started</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgetting-startedintroduction-li><input type=checkbox id=m-docsgetting-startedintroduction-check>
<label for=m-docsgetting-startedintroduction-check><a href=/docs/getting-started/introduction/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedintroduction><span>Introduction</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgetting-startedinstallation-li><input type=checkbox id=m-docsgetting-startedinstallation-check>
<label for=m-docsgetting-startedinstallation-check><a href=/docs/getting-started/installation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgetting-startedinstallation><span>Installation</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgetting-startedinstallationquick-start-li><input type=checkbox id=m-docsgetting-startedinstallationquick-start-check>
<label for=m-docsgetting-startedinstallationquick-start-check><a href=/docs/getting-started/installation/quick-start/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedinstallationquick-start><span>Quick Start</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgetting-startedinstallationinstallation-li><input type=checkbox id=m-docsgetting-startedinstallationinstallation-check>
<label for=m-docsgetting-startedinstallationinstallation-check><a href=/docs/getting-started/installation/installation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedinstallationinstallation><span>Installation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgetting-startedinstallationinstallation-cli-tool-li><input type=checkbox id=m-docsgetting-startedinstallationinstallation-cli-tool-check>
<label for=m-docsgetting-startedinstallationinstallation-cli-tool-check><a href=/docs/getting-started/installation/installation-cli-tool/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedinstallationinstallation-cli-tool><span>Installation of CLI Tool</span></a></label></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscore-concept-li><input type=checkbox id=m-docscore-concept-check>
<label for=m-docscore-concept-check><a href=/docs/core-concept/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscore-concept><span>Core Concept</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscore-conceptresource-optimize-model-li><input type=checkbox id=m-docscore-conceptresource-optimize-model-check>
<label for=m-docscore-conceptresource-optimize-model-check><a href=/docs/core-concept/resource-optimize-model/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscore-conceptresource-optimize-model><span>Application Resource Optimize Model</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscore-concepttimeseries-forecasting-by-dsp-li><input type=checkbox id=m-docscore-concepttimeseries-forecasting-by-dsp-check>
<label for=m-docscore-concepttimeseries-forecasting-by-dsp-check><a href=/docs/core-concept/timeseries-forecasting-by-dsp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscore-concepttimeseries-forecasting-by-dsp><span>Time Series Forecast Algorithm-DSP</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscore-conceptarchitecture-li><input type=checkbox id=m-docscore-conceptarchitecture-check>
<label for=m-docscore-conceptarchitecture-check><a href=/docs/core-concept/architecture/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscore-conceptarchitecture><span>Architecture</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docstutorials-li><input type=checkbox id=m-docstutorials-check>
<label for=m-docstutorials-check><a href=/docs/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docstutorials><span>Tutorials</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docstutorialscolocation-with-enhanced-qos-li><input type=checkbox id=m-docstutorialscolocation-with-enhanced-qos-check>
<label for=m-docstutorialscolocation-with-enhanced-qos-check><a href=/docs/tutorials/colocation-with-enhanced-qos/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docstutorialscolocation-with-enhanced-qos><span>Colocation with Enhanced QOS</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialscolocation-with-enhanced-qosusing-qos-ensurance-li><input type=checkbox id=m-docstutorialscolocation-with-enhanced-qosusing-qos-ensurance-check>
<label for=m-docstutorialscolocation-with-enhanced-qosusing-qos-ensurance-check><a href=/docs/tutorials/colocation-with-enhanced-qos/using-qos-ensurance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialscolocation-with-enhanced-qosusing-qos-ensurance><span>Colocation with Enhanced QOS</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialscolocation-with-enhanced-qosqos-interference-detection-and-active-avoidance-li><input type=checkbox id=m-docstutorialscolocation-with-enhanced-qosqos-interference-detection-and-active-avoidance-check>
<label for=m-docstutorialscolocation-with-enhanced-qosqos-interference-detection-and-active-avoidance-check><a href=/docs/tutorials/colocation-with-enhanced-qos/qos-interference-detection-and-active-avoidance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialscolocation-with-enhanced-qosqos-interference-detection-and-active-avoidance><span>Interference Detection and Active Avoidance</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialscolocation-with-enhanced-qosqos-dynamic-resource-oversold-and-limit-li><input type=checkbox id=m-docstutorialscolocation-with-enhanced-qosqos-dynamic-resource-oversold-and-limit-check>
<label for=m-docstutorialscolocation-with-enhanced-qosqos-dynamic-resource-oversold-and-limit-check><a href=/docs/tutorials/colocation-with-enhanced-qos/qos-dynamic-resource-oversold-and-limit/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialscolocation-with-enhanced-qosqos-dynamic-resource-oversold-and-limit><span>Dynamic resource oversold and limit</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialscolocation-with-enhanced-qosqos-accurately-perform-avoidance-actions-li><input type=checkbox id=m-docstutorialscolocation-with-enhanced-qosqos-accurately-perform-avoidance-actions-check>
<label for=m-docstutorialscolocation-with-enhanced-qosqos-accurately-perform-avoidance-actions-check><a href=/docs/tutorials/colocation-with-enhanced-qos/qos-accurately-perform-avoidance-actions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialscolocation-with-enhanced-qosqos-accurately-perform-avoidance-actions><span>Accurately Perform Avoidance Actions</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialscolocation-with-enhanced-qosqos-customized-metrics-interference-detection-avoidance-and-sorting-li><input type=checkbox id=m-docstutorialscolocation-with-enhanced-qosqos-customized-metrics-interference-detection-avoidance-and-sorting-check>
<label for=m-docstutorialscolocation-with-enhanced-qosqos-customized-metrics-interference-detection-avoidance-and-sorting-check><a href=/docs/tutorials/colocation-with-enhanced-qos/qos-customized-metrics-interference-detection-avoidance-and-sorting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialscolocation-with-enhanced-qosqos-customized-metrics-interference-detection-avoidance-and-sorting><span>Define your watermark</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialscolocation-with-enhanced-qosqos-enhanced-bypass-cpuset-management-li><input type=checkbox id=m-docstutorialscolocation-with-enhanced-qosqos-enhanced-bypass-cpuset-management-check>
<label for=m-docstutorialscolocation-with-enhanced-qosqos-enhanced-bypass-cpuset-management-check><a href=/docs/tutorials/colocation-with-enhanced-qos/qos-enhanced-bypass-cpuset-management/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialscolocation-with-enhanced-qosqos-enhanced-bypass-cpuset-management><span>Enhanced bypass cpuset management capability</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docstutorialsrecommendation-li><input type=checkbox id=m-docstutorialsrecommendation-check>
<label for=m-docstutorialsrecommendation-check><a href=/docs/tutorials/recommendation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docstutorialsrecommendation><span>Recommendation</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsrecommendationrecommendation-framework-li><input type=checkbox id=m-docstutorialsrecommendationrecommendation-framework-check>
<label for=m-docstutorialsrecommendationrecommendation-framework-check><a href=/docs/tutorials/recommendation/recommendation-framework/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsrecommendationrecommendation-framework><span>Recommendation Framework</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsrecommendationreplicas-recommendation-li><input type=checkbox id=m-docstutorialsrecommendationreplicas-recommendation-check>
<label for=m-docstutorialsrecommendationreplicas-recommendation-check><a href=/docs/tutorials/recommendation/replicas-recommendation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsrecommendationreplicas-recommendation><span>Replicas Recommendation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsrecommendationresource-recommendation-li><input type=checkbox id=m-docstutorialsrecommendationresource-recommendation-check>
<label for=m-docstutorialsrecommendationresource-recommendation-check><a href=/docs/tutorials/recommendation/resource-recommendation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsrecommendationresource-recommendation><span>Resource Recommendation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsrecommendationidlenode-recommendation-li><input type=checkbox id=m-docstutorialsrecommendationidlenode-recommendation-check>
<label for=m-docstutorialsrecommendationidlenode-recommendation-check><a href=/docs/tutorials/recommendation/idlenode-recommendation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsrecommendationidlenode-recommendation><span>IdleNode Recommendation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsrecommendationhpa-recommendation-li><input type=checkbox id=m-docstutorialsrecommendationhpa-recommendation-check>
<label for=m-docstutorialsrecommendationhpa-recommendation-check><a href=/docs/tutorials/recommendation/hpa-recommendation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsrecommendationhpa-recommendation><span>HPA Recommendation（Alpha）</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsrecommendationservice-recommendation-li><input type=checkbox id=m-docstutorialsrecommendationservice-recommendation-check>
<label for=m-docstutorialsrecommendationservice-recommendation-check><a href=/docs/tutorials/recommendation/service-recommendation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsrecommendationservice-recommendation><span>Service Recommendation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsrecommendationpv-recommendation-li><input type=checkbox id=m-docstutorialsrecommendationpv-recommendation-check>
<label for=m-docstutorialsrecommendationpv-recommendation-check><a href=/docs/tutorials/recommendation/pv-recommendation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsrecommendationpv-recommendation><span>PV Recommendation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsrecommendationhow-to-develop-recommender-li><input type=checkbox id=m-docstutorialsrecommendationhow-to-develop-recommender-check>
<label for=m-docstutorialsrecommendationhow-to-develop-recommender-check><a href=/docs/tutorials/recommendation/how-to-develop-recommender/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsrecommendationhow-to-develop-recommender><span>How to develop Recommender</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsdynamic-scheduler-plugin-li><input type=checkbox id=m-docstutorialsdynamic-scheduler-plugin-check>
<label for=m-docstutorialsdynamic-scheduler-plugin-check><a href=/docs/tutorials/dynamic-scheduler-plugin/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsdynamic-scheduler-plugin><span>Dynamic-scheduler: a load-aware scheduler plugin</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsscheduling-pods-based-on-actual-node-load-li><input type=checkbox id=m-docstutorialsscheduling-pods-based-on-actual-node-load-check>
<label for=m-docstutorialsscheduling-pods-based-on-actual-node-load-check><a href=/docs/tutorials/scheduling-pods-based-on-actual-node-load/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsscheduling-pods-based-on-actual-node-load><span>Crane-scheduler</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsusing-effective-hpa-to-scaling-with-effectiveness-li><input type=checkbox id=m-docstutorialsusing-effective-hpa-to-scaling-with-effectiveness-check>
<label for=m-docstutorialsusing-effective-hpa-to-scaling-with-effectiveness-check><a href=/docs/tutorials/using-effective-hpa-to-scaling-with-effectiveness/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsusing-effective-hpa-to-scaling-with-effectiveness><span>Effective HorizontalPodAutoscaler</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docstutorialsusing-time-series-prediction-li><input type=checkbox id=m-docstutorialsusing-time-series-prediction-check>
<label for=m-docstutorialsusing-time-series-prediction-check><a href=/docs/tutorials/using-time-series-prediction/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docstutorialsusing-time-series-prediction><span>TimeSeriesPrediction</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsbest-practices-li><input type=checkbox id=m-docsbest-practices-check checked>
<label for=m-docsbest-practices-check><a href=/docs/best-practices/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsbest-practices><span>Best Practices</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsbest-practiceseffective-hpa-with-prometheus-adapter-li><input type=checkbox id=m-docsbest-practiceseffective-hpa-with-prometheus-adapter-check>
<label for=m-docsbest-practiceseffective-hpa-with-prometheus-adapter-check><a href=/docs/best-practices/effective-hpa-with-prometheus-adapter/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsbest-practiceseffective-hpa-with-prometheus-adapter><span>Intelligent Autoscaling Practices Based on Effective HPA for Custom Metrics</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsbest-practiceshow-to-optimize-your-application-resource-li><input type=checkbox id=m-docsbest-practiceshow-to-optimize-your-application-resource-check>
<label for=m-docsbest-practiceshow-to-optimize-your-application-resource-check><a href=/docs/best-practices/how-to-optimize-your-application-resource/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsbest-practiceshow-to-optimize-your-application-resource><span class=td-sidebar-nav-active-item>How to optimize your application in FinOps era</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsbest-practiceshow-kujiale-adopt-ehpa-li><input type=checkbox id=m-docsbest-practiceshow-kujiale-adopt-ehpa-check>
<label for=m-docsbest-practiceshow-kujiale-adopt-ehpa-check><a href=/docs/best-practices/how-kujiale-adopt-ehpa/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsbest-practiceshow-kujiale-adopt-ehpa><span>How Kujiale achieve autoscaling with Crane EHPA</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsproposals-li><input type=checkbox id=m-docsproposals-check>
<label for=m-docsproposals-check><a href=/docs/proposals/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsproposals><span>Proposals</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposals20220228-advanced-cpuset-manger-li><input type=checkbox id=m-docsproposals20220228-advanced-cpuset-manger-check>
<label for=m-docsproposals20220228-advanced-cpuset-manger-check><a href=/docs/proposals/20220228-advanced-cpuset-manger/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposals20220228-advanced-cpuset-manger><span>Advanced CPUSet Manager</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposals20220402-policy-based-abnomal-detection-li><input type=checkbox id=m-docsproposals20220402-policy-based-abnomal-detection-check>
<label for=m-docsproposals20220402-policy-based-abnomal-detection-check><a href=/docs/proposals/20220402-policy-based-abnomal-detection/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposals20220402-policy-based-abnomal-detection><span>Provide a policy-based abnormal detection mechanism in crane-agent</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposals20220706-recommendation-framework-li><input type=checkbox id=m-docsproposals20220706-recommendation-framework-check>
<label for=m-docsproposals20220706-recommendation-framework-check><a href=/docs/proposals/20220706-recommendation-framework/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposals20220706-recommendation-framework><span>Recommendation Framework</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalspod-sorting-and-precise-execution-for-crane-agent-li><input type=checkbox id=m-docsproposalspod-sorting-and-precise-execution-for-crane-agent-check>
<label for=m-docsproposalspod-sorting-and-precise-execution-for-crane-agent-check><a href=/docs/proposals/pod-sorting-and-precise-execution-for-crane-agent/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalspod-sorting-and-precise-execution-for-crane-agent><span>Pod Sorting And Precise Execution For Crane Agent</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscontributing-li><input type=checkbox id=m-docscontributing-check>
<label for=m-docscontributing-check><a href=/docs/contributing/ title=Contributing class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscontributing><span>Contributing Guidelines</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontributingcontributing-li><input type=checkbox id=m-docscontributingcontributing-check>
<label for=m-docscontributingcontributing-check><a href=/docs/contributing/contributing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributingcontributing><span>Contributing to Crane</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontributingdeveloper-guide-li><input type=checkbox id=m-docscontributingdeveloper-guide-check>
<label for=m-docscontributingdeveloper-guide-check><a href=/docs/contributing/developer-guide/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributingdeveloper-guide><span>Developer Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontributingcode-standards-li><input type=checkbox id=m-docscontributingcode-standards-check>
<label for=m-docscontributingcode-standards-check><a href=/docs/contributing/code-standards/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributingcode-standards><span>Code Standard</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsroadmap-li><input type=checkbox id=m-docsroadmap-check>
<label for=m-docsroadmap-check><a href=/docs/roadmap/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsroadmap><span>Roadmap</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsroadmaproadmap-2023-li><input type=checkbox id=m-docsroadmaproadmap-2023-check>
<label for=m-docsroadmaproadmap-2023-check><a href=/docs/roadmap/roadmap-2023/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsroadmaproadmap-2023><span>Roadmap for 2023</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsroadmaproadmap-2022-li><input type=checkbox id=m-docsroadmaproadmap-2022-check>
<label for=m-docsroadmaproadmap-2022-check><a href=/docs/roadmap/roadmap-2022/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsroadmaproadmap-2022><span>Roadmap for 2022</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsmirror-resources-li><input type=checkbox id=m-docsmirror-resources-check>
<label for=m-docsmirror-resources-check><a href=/docs/mirror-resources/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsmirror-resources><span>Mirror Resources</span></a></label></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#kubernetes-how-to-manage-resources>Kubernetes How to manage resources</a><ul><li><a href=#pod-resource-model>Pod Resource model</a></li><li><a href=#workload-resource-model>Workload Resource model</a></li><li><a href=#common-resource-configuration-issues>Common resource configuration issues</a></li></ul></li><li><a href=#application-resource-optimization-model>Application Resource Optimization Model</a></li><li><a href=#optimizing-resource-configuration-through-the-crane-recommendation-framework>Optimizing resource configuration through the Crane recommendation framework</a><ul><li><a href=#create-recommendationrule>Create RecommendationRule</a></li><li><a href=#adjust-resource-configurations-based-on-optimization-recommendations-from-the-recommendation>Adjust resource configurations based on optimization recommendations from the Recommendation.</a></li><li><a href=#recommender>Recommender</a></li><li><a href=#resource-recommendations>Resource recommendations</a></li><li><a href=#differences-with-the-community>Differences with the community</a></li></ul></li><li><a href=#best-practices>Best practices</a><ul><li><a href=#cost-monitoring--calculating-costsbenefits>Cost Monitoring&ndash;Calculating Costs/Benefits</a></li><li><a href=#cost-analysis--establishing-systems>Cost Analysis&ndash;Establishing Systems</a></li><li><a href=#cost-optimization--progressive-recommendations>Cost Optimization&ndash;Progressive Recommendations</a></li></ul></li><li><a href=#roadmap>Roadmap</a></li><li><a href=#appendix>Appendix</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/best-practices/>Best Practices</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/best-practices/how-to-optimize-your-application-resource/>How to optimize your application in FinOps era</a></li></ol></nav><div class=td-content><h1>How to optimize your application in FinOps era</h1><div class=lead>How to optimize your application in FinOps era.</div><header class=article-meta><p class=reading-time><i class="fa fa-clock" aria-hidden=true></i>&nbsp; 14 minute read &nbsp;</p></header><p>As more and more enterprises migrate their applications to the Kubernetes platform, it has gradually become an important entry point for resource orchestration and scheduling. As we all know, Kubernetes schedules applications based on the resource quotas requested by the applications, so how to properly configure application resource specifications has become the key to improving cluster utilization. This article will share how to correctly configure application resources based on the FinOps open-source project Crane, and how to promote resource optimization practices within the enterprise.</p><h2 id=kubernetes-how-to-manage-resources>Kubernetes How to manage resources</h2><h3 id=pod-resource-model>Pod Resource model</h3><p>In Kubernetes, the desired amount of resources for a Pod can be selectively set by specifying Request/Limit. When the resource Request is specified for a Container in a Pod, Kube-scheduler uses this information to determine which node to schedule the Pod on. When the resource Request and Limit are specified for a Container, kubelet ensures that the running container can access the requested resources through Cgroup parameters and does not use resources beyond the set limit. Kubelet also reserves system resources equal to the Request amount for the container to use.
example of resource configuration for a Pod：</p><pre tabindex=0><code>apiVersion: v1
kind: Pod
metadata:
  name: frontend
spec:
  containers:
  - name: app
    image: images.my-company.example/app:v4
    resources:
      requests:
        memory: &#34;64Mi&#34;
        cpu: &#34;250m&#34;
      limits:
        memory: &#34;128Mi&#34;
        cpu: &#34;500m&#34;
</code></pre><p>Once the resource request amount is determined, the resource utilization formula for an application can be derived as follows: Utilization = Resource Usage / Resource Request.</p><p>Therefore, to improve the utilization of Pods, we need to configure reasonable resource requests.</p><h3 id=workload-resource-model>Workload Resource model</h3><p>A workload is an application that runs on Kubernetes, consisting of a group of Pods, such as Deployments and StatefulSets. The number of Pods is referred to as the workload&rsquo;s replica count.</p><p>The resource utilization formula for a workload is: Workload Utilization = (Pod1 Usage + Pod2 Usage + &mldr; PodN Usage) / (Request * Replicas).</p><p>As the formula shows, improving workload utilization can not only reduce the Request, but also reduce the Replicas.</p><h3 id=common-resource-configuration-issues>Common resource configuration issues</h3><p>The Canadian software company Densify summarized common resource configuration issues in &ldquo;12 RISK OF KUBERNETES RESOURCE MANAGEMENT&rdquo; [1]. In the table below, we have added an analysis dimension of replica counts based on their findings.</p><table><thead><tr><th></th><th>CPU Request</th><th>Memory Request</th><th>CPU Limit</th><th>Memory Limit</th><th>Replicas</th></tr></thead><tbody><tr><td>Oversized</td><td>Excess CPU resources lead to more waste of nodes and resources</td><td>K8s scheduler may request excessive Memory resources, leading to more waste of nodes and resources.</td><td>Allowing Pods to request excessive CPU resources can create a &rsquo;noisy neighbor&rsquo; risk, affecting other Pods on the same node</td><td>Allowing Pods to request excessive Memory resources can create a &rsquo;noisy neighbor&rsquo; risk, which in turn can affect other Pods running on the same node</td><td>Excessive Pods can lead to more waste of nodes and resources</td></tr><tr><td>Undersized</td><td>This can lead to excessive stacking of Pods on nodes, and if all CPU resources are exhausted, it can result in contention and risk of CPU throttling at the node level</td><td>This can lead to excessive stacking of Pods on nodes, and if all Memory resources are exhausted, it can result in the risk of Pod termination (OOM Killer) at the node level</td><td>The Pod&rsquo;s CPU usage will be limited, and if the actual workload exceeds the limit, it can result in CPU throttling and performance degradation</td><td>The Pod&rsquo;s Memory usage will be limited, and if the actual workload exceeds the limit, it can trigger the OOM Killer to terminate processes</td><td>Having too few Pods can result in high utilization rates, leading to stability issues such as performance degradation and OOM Killer</td></tr><tr><td>Unset</td><td>K8s scheduler will be uncertain about how many Pods can be scheduled in the cluster, and excessive stacking of Pods can create significant performance risks and uneven workloads</td><td>The scheduler will be uncertain about how many Pods can be scheduled in the cluster, which can lead to excessive stacking and the risk of Pods being OOM killed</td><td>Unconstrained Pods can amplify the &rsquo;noisy neighbor&rsquo; effect and create the risk of CPU throttling</td><td>Unconstrained Pods can amplify the &rsquo;noisy neighbor&rsquo; risk, and if the node&rsquo;s memory is exhausted, it can trigger the OOM Killer to terminate processes</td><td>N/A</td></tr></tbody></table><p>As we can see, setting resource limits too low can lead to stability issues, while setting them too high only results in &ldquo;mere&rdquo; resource waste, which can be acceptable during periods of rapid business growth. This is the main reason why resource utilization rates are generally low for many businesses after migrating to the cloud. The following graph shows the resource usage of an application, with 30% resource waste between the peak historical usage of the Pod and its Request amount.
<img src=/images/resource-waste.jpg alt="Resource Waste"></p><h2 id=application-resource-optimization-model>Application Resource Optimization Model</h2><p>After mastering Kubernetes&rsquo; resource model, we can further derive a resource optimization model for cloud-native applications:</p><p><img src=/images/resource-model.png alt="Crane Overview"></p><p>The five lines in the graph from top to bottom are:</p><ol><li>Node Capacity: The total amount of resources in all nodes in the cluster, corresponding to the Capacity of the cluster.</li><li>Allocated: The total amount of resources allocated by the application, corresponding to the Pod Request.</li><li>Weekly Peak: The peak resource usage of the application during a certain period in the past. Weekly peak can be used to predict future resource usage, and configuring resource specifications based on weekly peak has higher security and more general applicability.</li><li>Daily Average Peak: The peak resource usage of the application in the past day.</li><li>Mean: The average resource usage of the application, corresponding to Usage.</li></ol><p>The idle resources can be divided into two categories:</p><ol><li>Resource Slack: The difference between Capacity and Request.</li><li>Usage Slack: The difference between Request and Usage.</li></ol><p>Total Slack = Resource Slack + Usage Slack</p><p>The goal of resource optimization is to reduce Resource Slack and Usage Slack. The model provides four steps for reducing waste, in order from top to bottom:</p><ol><li>Improving packing rate: Improving the packing rate can bring the Capacity and Request closer together. There are many ways to achieve this, such as:<a href=/zh-cn/docs/tutorials/scheduling-pods-based-on-actual-node-load>Dynamic scheduler</a>、Tencent Cloud Native Node&rsquo;s node amplification function, etc.</li><li>Adjusting business specifications to reduce resource locking: Adjusting business specifications based on the weekly peak resource usage can reduce the Request to the weekly peak line.<a href=/docs/tutorials/recommendation/resource-recommendation>Resource recommendation</a> and <a href=/docs/tutorials/recommendation/replicas-recommendation>Replicas Recommendation</a>can help applications achieve this goal.</li><li>Adjusting business specifications + scaling to handle burst traffic: Based on the optimization of specifications, HPA can handle burst traffic to reduce the Request to the daily peak line. At this time, the target utilization rate of HPA is low, only to handle burst traffic, and automatic elasticity does not occur most of the time.</li><li>Adjusting business specifications + scaling to handle daily traffic changes: Based on the optimization of specifications, HPA can handle daily traffic to reduce the Request to the mean. At this time, the target utilization rate of HPA is equal to the average utilization rate of the application.</li></ol><p>Based on this model, the open-source project Crane provides dynamic scheduling, recommendation framework, intelligent elasticity, and mixed deployment capabilities, realizing an all-in-one FinOps cloud resource optimization platform. In this article, we will focus on the recommendation framework.</p><h2 id=optimizing-resource-configuration-through-the-crane-recommendation-framework>Optimizing resource configuration through the Crane recommendation framework</h2><p>The open-source project Crane has launched the Recommendation Framework, which automatically analyzes the operation of various resources in the cluster and provides optimization suggestions. By analyzing CPU/Memory monitoring data over a period of time and using resource recommendation algorithms, the Recommendation Framework provides resource configuration suggestions, allowing enterprises to make decisions based on the proposed configurations.</p><p>In the following example, we will demonstrate how to quickly start a full cluster resource recommendation.</p><p>Before embarking on this cost-cutting journey, you need to install Crane in your environment. Please refer to Crane&rsquo;s installation documentation for guidance.</p><h3 id=create-recommendationrule>Create RecommendationRule</h3><p>Here&rsquo;s a RecommendationRule example： workload-rule.yaml。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>analysis.crane.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>RecommendationRule</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>workloads-rule</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>runInterval</span>: <span style=color:#ae81ff>24h                           </span> <span style=color:#75715e># run once every 24 hours</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resourceSelectors</span>:                          <span style=color:#75715e># information about resources</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespaceSelector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>any</span>: <span style=color:#66d9ef>true</span>                                 <span style=color:#75715e># scan all namespaces</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>recommenders</span>:                               <span style=color:#75715e># Use replica and resource recommenders for Workloads</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Replicas</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Resource</span>
</span></span></code></pre></div><p>In this example:</p><ul><li>Analysis recommendations are run every 24 hours, with the runInterval format set as an interval of time, such as 1h or 1m. Setting it to empty means running only once.</li><li>The resources to be analyzed are set through the resourceSelectors array. Each resourceSelector selects resources in the k8s cluster based on kind, apiVersion, and name. When name is not specified, it means all resources under the namespaceSelector.</li><li>The namespaceSelector defines the namespaces of the resources to be analyzed. &ldquo;any: true&rdquo; means selecting all namespaces.</li><li>The recommenders define which Recommender(s) should be used for analyzing the resources. Currently supported types are: recommenders.</li><li>The resource types and recommenders need to be matched. For example, the Resource Recommender only supports Deployments and StatefulSets by default. Please refer to the recommender&rsquo;s documentation for which resource types each Recommender supports.</li></ul><ol><li>Create a RecommendationRule with the following command, and the recommendation will start immediately after creation.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl apply -f workload-rules.yaml
</span></span></code></pre></div><p>This example will perform resource and replica recommendations for Deployments and StatefulSets in all namespaces.
2. Check the recommendation progress of the RecommendationRule. Observe the progress of the recommendation task through Status.recommendations. The recommendation tasks are executed sequentially. If the lastStartTime of all tasks is the latest time and the message has a value, it indicates that the current recommendation has been completed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get rr workloads-rule
</span></span></code></pre></div><ol start=3><li>Query the recommendation results with the following command:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kubectl get recommend
</span></span></code></pre></div><p>You can filter the Recommendation by the following labels, for example: kubectl get recommend -l analysis.crane.io/recommendation-rule-name=workloads-rule</p><h3 id=adjust-resource-configurations-based-on-optimization-recommendations-from-the-recommendation>Adjust resource configurations based on optimization recommendations from the Recommendation.</h3><p>For resource and replica recommendations, users can PATCH status.recommendedInfo to the Workload to update the resource configurations. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>patchData<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>kubectl get recommend workloads-rule-replicas-rckvb -n default -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;{.status.recommendedInfo}&#39;</span><span style=color:#e6db74>`</span>;kubectl patch Deployment php-apache -n default --patch <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>patchData<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h3 id=recommender>Recommender</h3><p>Currently, Crane supports the following Recommenders:</p><ul><li><a href=/docs/tutorials/recommendation/resource-recommendation><strong>Resource Recommendation</strong></a>: By using the VPA algorithm to analyze the actual usage of applications, Crane recommends more appropriate resource configurations.</li><li><a href=/docs/tutorials/recommendation/replicas-recommendation><strong>Replicas Recommendation</strong></a>: By using the HPA algorithm to analyze the actual usage of applications, Crane recommends more appropriate replica numbers.</li><li><a href=/docs/tutorials/recommendation/hpa-recommendation><strong>HPA Recommendation</strong></a>: Scan the Workloads in the cluster and recommend HPA configurations for Workloads that are suitable for horizontal scaling.</li><li><a href=/docs/tutorials/recommendation/idlenode-recommendation><strong>Idlenode Recommendation</strong></a>: By scanning the state and utilization of nodes in the cluster, Node recommendation helps users find idle Kubernetes nodes.</li><li><a href=/docs/tutorials/recommendation/service-recommendation><strong>Service Recommendation</strong></a>: By scanning the running status of Services in the cluster, Service recommendation helps users find idle Kubernetes Services.</li><li><a href=/docs/tutorials/recommendation/pv-recommendation><strong>PV Recommendation</strong></a>: By scanning the running status of PV in the cluster, PV recommendation helps users find idle Kubernetes PV.</li></ul><p>This article focuses on optimizing resource configurations for Workloads, therefore, the following section will focus on resource recommendations and replica recommendations.</p><h3 id=resource-recommendations>Resource recommendations</h3><p>Here&rsquo;s an example of resource recommendations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>status</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>recommendedInfo</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        </span>        {<span style=color:#e6db74>&#34;spec&#34;</span>:{<span style=color:#e6db74>&#34;template&#34;</span>:{<span style=color:#e6db74>&#34;spec&#34;</span>:{<span style=color:#e6db74>&#34;containers&#34;</span>:[{<span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;craned&#34;</span>,<span style=color:#e6db74>&#34;resources&#34;</span>:{<span style=color:#e6db74>&#34;requests&#34;</span>:{<span style=color:#e6db74>&#34;cpu&#34;</span>:<span style=color:#e6db74>&#34;150m&#34;</span>,<span style=color:#e6db74>&#34;memory&#34;</span>:<span style=color:#e6db74>&#34;256Mi&#34;</span>}}},{<span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;dashboard&#34;</span>,<span style=color:#e6db74>&#34;resources&#34;</span>:{<span style=color:#e6db74>&#34;requests&#34;</span>:{<span style=color:#e6db74>&#34;cpu&#34;</span>:<span style=color:#e6db74>&#34;150m&#34;</span>,<span style=color:#e6db74>&#34;memory&#34;</span>:<span style=color:#e6db74>&#34;256Mi&#34;</span>}}}]}}}}
</span></span><span style=display:flex><span>  <span style=color:#f92672>currentInfo</span>: &gt;-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        </span>        {<span style=color:#e6db74>&#34;spec&#34;</span>:{<span style=color:#e6db74>&#34;template&#34;</span>:{<span style=color:#e6db74>&#34;spec&#34;</span>:{<span style=color:#e6db74>&#34;containers&#34;</span>:[{<span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;craned&#34;</span>,<span style=color:#e6db74>&#34;resources&#34;</span>:{<span style=color:#e6db74>&#34;requests&#34;</span>:{<span style=color:#e6db74>&#34;cpu&#34;</span>:<span style=color:#e6db74>&#34;500m&#34;</span>,<span style=color:#e6db74>&#34;memory&#34;</span>:<span style=color:#e6db74>&#34;512Mi&#34;</span>}}},{<span style=color:#e6db74>&#34;name&#34;</span>:<span style=color:#e6db74>&#34;dashboard&#34;</span>,<span style=color:#e6db74>&#34;resources&#34;</span>:{<span style=color:#e6db74>&#34;requests&#34;</span>:{<span style=color:#e6db74>&#34;cpu&#34;</span>:<span style=color:#e6db74>&#34;200m&#34;</span>,<span style=color:#e6db74>&#34;memory&#34;</span>:<span style=color:#e6db74>&#34;256Mi&#34;</span>}}}]}}}}
</span></span><span style=display:flex><span>  <span style=color:#f92672>action</span>: <span style=color:#ae81ff>Patch</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>conditions</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Ready</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>status</span>: <span style=color:#e6db74>&#39;True&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>lastTransitionTime</span>: <span style=color:#e6db74>&#39;2022-11-29T04:07:44Z&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>reason</span>: <span style=color:#ae81ff>RecommendationReady</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>message</span>: <span style=color:#ae81ff>Recommendation is ready</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>lastUpdateTime</span>: <span style=color:#e6db74>&#39;2022-11-30T03:07:49Z&#39;</span>
</span></span></code></pre></div><p>recommendedInfo displays the recommended resource configuration, while currentInfo displays the current resource configuration. The format is JSON, and the recommended results can be updated to TargetRef using Kubectl Patch.</p><h4 id=compute-resource-specification-algorithm>Compute resource specification algorithm</h4><p>The resource recommendation process is completed in the following steps:</p><ol><li>Obtain the CPU and memory usage history of the workload in the past week through monitoring data.</li><li>Based on the historical usage, use the VPA Histogram to take the P99 percentile and multiply it by an amplification factor.</li><li>OOM Protection: If there have been historical OOM events in the container, consider increasing memory appropriately when making memory recommendations.</li><li>Resource Specification Regularization: Round up the recommended results to the specified container specifications.
The basic principle is to set the Request slightly higher than the maximum historical usage based on historical resource usage, and consider factors such as OOM and Pod specifications.</li></ol><h4 id=replica-recommendations>Replica recommendations</h4><p>Here&rsquo;s an example of replica recommendations:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>status</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>recommendedInfo</span>: <span style=color:#e6db74>&#39;{&#34;spec&#34;:{&#34;replicas&#34;:1}}&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>currentInfo</span>: <span style=color:#e6db74>&#39;{&#34;spec&#34;:{&#34;replicas&#34;:2}}&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>action</span>: <span style=color:#ae81ff>Patch</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>conditions</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Ready</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>status</span>: <span style=color:#e6db74>&#39;True&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>lastTransitionTime</span>: <span style=color:#e6db74>&#39;2022-11-28T08:07:36Z&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>reason</span>: <span style=color:#ae81ff>RecommendationReady</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>message</span>: <span style=color:#ae81ff>Recommendation is ready</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>lastUpdateTime</span>: <span style=color:#e6db74>&#39;2022-11-29T11:07:45Z&#39;</span>
</span></span></code></pre></div><p>The recommendedInfo displays the recommended replica count, and the currentInfo displays the current replica count in JSON format. The recommended results can be updated to TargetRef using Kubectl Patch.</p><p>The replica recommendation process is completed in the following steps:</p><ol><li>Obtain the CPU and memory usage history of the workload in the past week through monitoring data.</li><li>Use the DSP algorithm to predict the future CPU usage for the next week.</li><li>Calculate the replica count for CPU and memory separately, and take the larger value.</li></ol><h4 id=compute-replica-algorithm>Compute replica algorithm</h4><p>Taking CPU as an example, assuming that the P99 of the historical CPU usage of the workload is 10 cores, and the Pod CPU Request is 5 cores, the target peak utilization is 50%. It can be inferred that 4 replicas are needed to meet the requirement of the peak utilization not being less than 50%.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>replicas := int32(math.Ceil(workloadUsage / (TargetUtilization * float64(requestTotal))))</span>
</span></span></code></pre></div><h3 id=differences-with-the-community>Differences with the community</h3><p>According to the resource optimization model, the recommendation framework can reduce the Request of the application to the weekly peak, and the recommendation framework only provides specification recommendations without executing changes, which is more secure and applicable to more business types. If further Request reduction is needed, HPA and other solutions can be considered.</p><table><thead><tr><th></th><th>utilization rate</th><th>management configuration type</th><th>change type</th></tr></thead><tbody><tr><td>Community HPA</td><td>average utilization rate</td><td>replica number</td><td>automatic scaling</td></tr><tr><td>Community VPA</td><td>approximate peak utilization rate</td><td>resource Request</td><td>automatic scaling/recommendation</td></tr><tr><td>Crane recommendation framework</td><td>weekly peak utilization rate</td><td>replica number + resources Request</td><td>automatic scaling/recommendation</td></tr><tr><td>advantages of the recommendation framework</td><td>Although the weekly peak utilization rate provides relatively small cost reduction space, it is simple to configure, safer, and applicable to more types of applications.</td><td>Both replica number and resource Request can be recommended simultaneously, and adjustments can be made as needed.</td><td>Provide recommendation suggestions through CRD/Metric, which is convenient for integration into user systems. In the future, it will support automatic updates through CICD</td></tr></tbody></table><h2 id=best-practices>Best practices</h2><p>FinOps recommends using an iterative approach to manage variable costs of cloud services. The continuous management iteration consists of three phases: cost observation (Inform), cost analysis (Recommend), and cost optimization (Operate). In the following section, we will introduce how to use Crane for K8S resource configuration management based on these three phases and the internal practice experience of Tencent.</p><h3 id=cost-monitoring--calculating-costsbenefits>Cost Monitoring&ndash;Calculating Costs/Benefits</h3><p>Cost observation is the core key to the cost reduction journey. Only by setting clear goals can cost reduction optimization be targeted. Therefore, users need to establish a monitoring and observation system for cluster resources to evaluate whether cost reduction and efficiency improvement are necessary. For example, what is the packing rate of the cluster? What is the average/peak utilization rate of the cluster? What is the resource usage distribution of each Namespace, and what is the average/peak utilization rate of each Workload?</p><h3 id=cost-analysis--establishing-systems>Cost Analysis&ndash;Establishing Systems</h3><p>The Crane recommendation framework provides a complete set of analysis and optimization tools for full-fledged analysis of cluster resources, and records the recommended results in CRD and Metrics for easy integration into business systems.</p><p>The practice within Tencent is as follows:</p><ol><li>Use RecommendationRule to recommend resources and replicas for all workloads in the cluster, updated every 12 hours.</li><li>Display the complete recommendation results separately in the control interface.</li><li>Display resource/replica recommendations on the workload data display page.</li><li>Display observation data of the workload in Grafana charts.</li><li>Provide OpenAPI for businesses to obtain recommendations and optimize them according to business needs.</li></ol><h3 id=cost-optimization--progressive-recommendations>Cost Optimization&ndash;Progressive Recommendations</h3><p>The FinOps Foundation has defined a &ldquo;crawl, walk, run&rdquo; maturity method for FinOps, enabling enterprises to start small and gradually expand in scale, scope, and complexity. Similarly, the premise of cost reduction is to ensure stability, as changes in resource configuration and unreasonable configurations may affect business stability. User optimization processes should follow the same approach:</p><ol><li>Verify the accuracy of the configuration in the CI/CD environment before updating the production environment.</li><li>Optimize businesses with severe waste first, and then optimize businesses with relatively low configurations.</li><li>Optimize non-core businesses first, and then optimize core businesses.</li><li>Configure recommended parameters based on business characteristics: Online businesses require more resource buffers, while offline businesses can accept higher utilization rates.</li><li>The release platform prompts users with recommended configurations and updates only after confirmation to prevent unexpected online changes.</li><li>Some business clusters automatically update workload configurations based on recommended suggestions to achieve higher utilization rates.</li></ol><p>In the book &ldquo;Cloud FinOps&rdquo; which introduces FinOps, it shares an example of a Fortune 500 company optimizing resources through an automated system, with the following workflow:</p><p><img src=/images/resource-flow.png alt="Resource flow"></p><p>Automated configuration optimization is considered an advanced stage in FinOps and is recommended for use in the advanced stages of FinOps implementation. However, you should consider tracking the recommendations and have the corresponding team manually implement the necessary changes.</p><h2 id=roadmap>Roadmap</h2><p>Whether or not resource optimization is needed, Crane can be used as a trial object when practicing FinOps. You can first understand the current state of the Kubernetes cluster through cost display, and choose the optimization method based on the problem. Resource configuration optimization, as introduced in this article, is the most direct and common method.</p><p>In the future, the Crane recommendation framework will evolve towards more accurate, intelligent, and rich goals:</p><p>-Integration with CI/CD frameworks: Automated configuration updates can further improve utilization rates compared to manual updates and are suitable for business scenarios with higher resource utilization rates.
-Cost left shift: Discover and solve resource waste earlier through configuration optimization in the CI/CD stage.
-Configuration recommendation based on application load characteristics: Identify load patterns and burst tasks based on algorithms and provide reasonable recommendations.
-Resource recommendation for task types: Currently, more support is provided for long-running online businesses, but resource recommendations can also optimize configuration for task-type applications.
-Analysis of more types of idle resources in Kubernetes: Scan idle resources in the cluster, such as Load Balancer/Storage/Node/GPU.</p><h2 id=appendix>Appendix</h2><p>1.The Top 12 Kubernetes Resource Risks: K8s Best Practices: <a href=https://www.densify.com/resources/k8s-resource-risks>Top 12 Kubernetes Resource Risks</a></p></div></main></div></div></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.aa9f4c5dae6a98b2c46277f4c56f1673a2b000d1756ce4ffae93784cab25e6d5.js integrity="sha256-qp9MXa5qmLLEYnf0xW8Wc6KwANF1bOT/rpN4TKsl5tU=" crossorigin=anonymous></script></body></html>